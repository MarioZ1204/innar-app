<!-- public/index.html -->
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Innar-App</title>
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="stylesheet" href="style.css">
  <style>
    @keyframes moveUp {
      0% { transform: translateY(8px); opacity: 0.0; }
      60% { transform: translateY(-6px); opacity: 0.95; }
      100% { transform: translateY(0); opacity: 1; }
    }
    .animate-up {
      animation: moveUp 700ms ease forwards;
      background: linear-gradient(90deg, rgba(255,249,196,0.9), rgba(255,255,255,0.0));
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <!-- ========== PANTALLA DE LOGIN ========== -->
  <div id="view-login" class="view-login hidden">
    <div class="login-box">
      <div class="login-header">
        <img src="logo3.png" alt="Logo Instituto Neurociencias" class="login-logo" />
        <h1>Instituto Neurociencias de Nari√±o IPS S.A.S</h1>
        <p>Reg√≠strate para continuar</p>
      </div>
      <form id="formLogin" class="login-form">
        <div class="form-group">
          <label for="loginUsuario">Usuario</label>
          <input id="loginUsuario" type="text" placeholder="Usuario" autocomplete="username" required />
        </div>
        <div class="form-group">
          <label for="loginPassword">Contrase√±a</label>
          <input id="loginPassword" type="password" placeholder="Contrase√±a" autocomplete="current-password" required />
        </div>
        <div id="loginError" class="login-error hidden"></div>
        <button type="submit" id="btnLogin" class="btn-login">Iniciar sesi√≥n</button>
      </form>
    </div>
  </div>

  <!-- ========== MEN√ö PRINCIPAL ========== -->
  <div id="view-menu" class="view-menu hidden">
    <header class="menu-header">
      <img src="logo3.png" alt="Logo" class="menu-logo" />
      <div class="menu-user">
        <span id="menuUserName"></span>
        <button id="btnCambiarContrasena" class="btn-logout" title="Gestionar tu cuenta"> Mi Cuenta</button>
        <button id="btnLogout" class="btn-logout">Cerrar sesi√≥n</button>
      </div>
    </header>
    <div class="menu-content">
      <h2>¬øQu√© deseas hacer?</h2>
      <div class="menu-cards" id="menuCardsContainer">
        <button class="menu-card" data-module="recibos" data-rol="admin recepcion">
          <span class="menu-card-icon"><img src="iconrecibos.png" alt="Recibos" class="icon-img" /></span>
          <span class="menu-card-title">Recibos</span>
          <span class="menu-card-desc">Crear recibos, ver historial y reportes</span>
        </button>
        <button class="menu-card" data-module="agenda-medica" data-rol="admin recepcion electro doctor">
          <span class="menu-card-icon"><img src="iconagenda.png" alt="Agenda M√©dica" class="icon-img" /></span>
          <span class="menu-card-title">Agenda M√©dica</span>
          <span class="menu-card-desc">Citas por consultorio</span>
        </button>
        <button class="menu-card" data-module="electro" data-rol="admin recepcion electro doctor">
          <span class="menu-card-icon"><img src="iconelectro.png" alt="Electrodiagn√≥stico" class="icon-img" /></span>
          <span class="menu-card-title">Agenda Electrodiagn√≥stico</span>
          <span class="menu-card-desc">Agenda de los 4 equipos de electrodiagn√≥stico</span>
        </button>
        <button class="menu-card" data-module="usuarios" data-rol="admin">
          <span class="menu-card-icon"><img src="iconuser.png" alt="Usuarios" class="icon-img" /></span>
          <span class="menu-card-title">Usuarios</span>
          <span class="menu-card-desc">Gestionar usuarios y roles</span>
        </button>
      </div>
    </div>
  </div>

  <!-- ========== M√ìDULO RECIBOS ========== -->
  <div id="view-recibos" class="view-module hidden">
    <div class="main-layout">
      <div class="sidebar no-print">
        <button class="btn-volver" id="btnVolverRecibos">‚Üê Volver</button>
        <div style="margin-bottom:24px;text-align:center">
          <img src="logo.png" alt="Logo" style="height:70px;width:auto;object-fit:contain" />
        </div>
        <button class="sidebar-btn active" data-page="crear">Crear Recibo</button>
        <button class="sidebar-btn" data-page="recibos">Ver Recibos</button>
        <button class="sidebar-btn" data-page="reportes">Reportes</button>
        <button class="sidebar-btn" data-page="servicios" data-rol-recibos="admin">Gestionar Servicios</button>
      </div>
      <div class="main-content">
        <div class="container" id="recibos-container">
          <!-- P√ÅGINA: CREAR RECIBO -->
          <div class="page active" id="page-crear">
            <header>
              <div><img src="logo1.png" alt="Logo" style="height:80px;object-fit:contain;display:block;margin:0 auto;" /></div>
            </header>
            <section id="statsSection" class="card no-print" style="background-color:#f0f9ff;border-left:4px solid #8AA6A1">
              <div style="display:flex;justify-content:space-around;align-items:center">
                <div style="text-align:center">
                  <div style="font-size:24px;font-weight:bold;color:#0369a1" id="statsRecibosHoy">0</div>
                  <div style="font-size:12px;color:#666">Recibos hoy</div>
                </div>
                <div style="text-align:center">
                  <div style="font-size:24px;font-weight:bold;color:#10b981" id="statsTotalHoy">$ 0.00</div>
                  <div style="font-size:12px;color:#666">Total del d√≠a</div>
                </div>
              </div>
            </section>
            <section class="card form-area">
              <div class="row">
                <div class="col"><label>Nombre Cliente</label><input id="cliente" placeholder="Nombre" /></div>
                <div class="col"><label>Documento Cliente</label><input id="docCliente" type="text" inputmode="numeric" placeholder="Documento" /></div>
              </div>
              <div class="row">
                <div class="col">
                  <label>Entidad</label>
                  <select id="entidad">
                    <option value="">Seleccionar entidad</option>
                    <option value="Protegemos">Protegemos</option>
                    <option value="Global Salud">Global Salud</option>
                    <option value="Particular">Particular</option>
                    <option value="Medica Preferencial">Medica Preferencial</option>
                    <option value="Multiservicios">Multiservicios</option>
                    <option value="Medica Estar Bien">Medica Estar Bien</option>
                    <option value="Previred">Previred</option>
                    <option value="Prevenir Descuentos">Prevenir Descuentos</option>
                    <option value="Clical Medic">Clical Medic</option>
                    <option value="Medicina Para Todos">Medicina Para Todos</option>
                    <option value="Otra">Otra</option>
                  </select>
                </div>
                <div class="col" id="entidadOtraContainer" style="display:none">
                  <label>Especificar entidad</label>
                  <input id="entidadOtra" type="text" placeholder="Escribir entidad" />
                </div>
              </div>
              <div style="margin-top:10px">
                <label>Conceptos</label>
                <table id="itemsTable">
                  <thead><tr><th>Descripci√≥n</th><th>Valor</th><th></th></tr></thead>
                  <tbody></tbody>
                </table>
                <div style="margin-top:8px"><button id="addItem">+ Agregar √≠tem manual</button></div>
              </div>
              <div class="row" style="margin-top:12px">
                <div class="col"><label>Observaciones</label><textarea id="observ" rows="2" placeholder="Opcional"></textarea></div>
                <div style="width:220px">
                  <label>N√∫mero de recibo</label><input id="numero" readonly />
                  <label>Fecha</label><input id="fecha" type="date" />
                </div>
              </div>
              <div class="actions"><button id="generate">Generar recibo</button></div>
            </section>
            <section id="receiptPreview" class="card">
              <div id="previewContent">
                <div class="receipt-header">
                  <div><strong>Instituto Neurociencias</strong><br/><small>Carrera 34 #13 - 80 ¬∑ 305-356-0651</small></div>
                  <div style="text-align:right">
                    <div>Recibo N¬∫ <strong id="r_num">0001</strong></div>
                    <div id="r_fecha">Fecha</div>
                  </div>
                </div>
                <hr/>
                <div>
                  <div><strong>Cliente:</strong> <span id="r_cliente"></span></div>
                  <div><strong>Documento:</strong> <span id="r_doc"></span></div>
                </div>
                <table id="r_table">
                  <thead><tr><th>Descripci√≥n</th><th>Precio</th></tr></thead>
                  <tbody></tbody>
                </table>
                <div style="text-align:right;margin-top:8px">
                  <div>Subtotal: <strong id="r_subtotal">0.00</strong></div>
                  <div>IVA: <strong id="r_iva">0.00</strong></div>
                  <div style="font-size:1.1rem">Total: <strong id="r_total">0.00</strong></div>
                </div>
                <div style="margin-top:8px"><strong>Observaciones:</strong> <span id="r_observ"></span></div>
              </div>
              <div class="actions no-print" style="margin-top:12px">
                <button id="print">Generar PDF</button>
                <button id="downloadPDF" class="secondary">Descargar PDF anterior</button>
              </div>
            </section>
          </div>
          <!-- P√ÅGINA: VER RECIBOS -->
          <div class="page" id="page-recibos">
            <header><h2>Recibos Guardados</h2></header>
            <section id="savedList" class="card no-print">
              <div style="overflow-x:auto">
                <table id="tablaSavedItems" style="width:100%;border-collapse:collapse;margin-bottom:12px;">
                  <thead style="background:#f3f4f6;border-bottom:2px solid #d1d5db">
                    <tr>
                      <th style="padding:12px;text-align:left;font-weight:600;color:#374151;border:1px solid #e5e7eb">N√∫mero</th>
                      <th style="padding:12px;text-align:left;font-weight:600;color:#374151;border:1px solid #e5e7eb">Cliente</th>
                      <th style="padding:12px;text-align:left;font-weight:600;color:#374151;border:1px solid #e5e7eb">Fecha</th>
                      <th style="padding:12px;text-align:right;font-weight:600;color:#374151;border:1px solid #e5e7eb">Total</th>
                      <th style="padding:12px;text-align:center;font-weight:600;color:#374151;border:1px solid #e5e7eb">Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="savedItems">
                    <tr>
                      <td colspan="5" style="padding:12px;text-align:center;color:#999">No hay recibos guardados</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <button id="resetAll" class="secondary" style="margin-top:12px;width:100%;background:#dc2626;display:none">Eliminar todos los recibos</button>
            </section>
          </div>
          <!-- P√ÅGINA: REPORTES -->
          <div class="page" id="page-reportes">
            <header><h2>Generar Reportes</h2></header>
            <section id="reportSection" class="card no-print">
              <div class="row">
                <div class="col">
                  <label>Reporte Diario</label>
                  <div style="display:flex;gap:8px">
                    <input id="reportDiaFecha" type="date" />
                    <button id="reportDiaBtn" style="flex:1">Generar PDF</button>
                  </div>
                </div>
                <div class="col">
                  <label>Reporte Mensual</label>
                  <div style="display:flex;gap:8px">
                    <input id="reportMesFecha" type="month" />
                    <button id="reportMesBtn" style="flex:1">Generar PDF</button>
                  </div>
                </div>
              </div>
            </section>
          </div>
          <!-- P√ÅGINA: SERVICIOS -->
          <div class="page" id="page-servicios">
            <header><h2>Gestionar Servicios</h2></header>
            <section class="card no-print">
              <h3>Servicios Actuales</h3>
              <div id="serviciosList" style="margin-bottom:16px;max-height:400px;overflow-y:auto;border:1px solid #e5e7eb;padding:8px;border-radius:6px"></div>
              <h3 style="margin-top:20px">Agregar Nuevo Servicio</h3>
              <div style="display:flex;gap:8px;margin-bottom:12px">
                <input id="newServicioNombre" type="text" placeholder="Nombre del servicio" />
                <button id="addServicio">Agregar</button>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== M√ìDULO AGENDA M√âDICA (vista principal) ========== -->
  <div id="view-agenda-medica" class="view-module hidden">
    <div class="main-layout">
      <div class="sidebar">
        <button class="btn-volver" id="btnVolverAgenda">‚Üê Volver</button>
        <div style="margin-bottom:24px;text-align:center">
          <img src="logo.png" alt="Logo" style="height:70px;width:auto;object-fit:contain" />
        </div>
        <h2 style="color:white;margin-bottom:16px">Agenda M√©dica</h2>
        <button class="sidebar-btn agenda-page-btn active" data-page="citas">Ver Citas</button>
        <button class="sidebar-btn agenda-page-btn" data-page="programar" id="btnAgendaProgramar" style="display:none">Programar Agenda</button>
      </div>
      <div class="main-content">
        <div class="container">
          <!-- P√ÅGINA: VER CITAS -->
          <div class="agenda-page active" data-agenda-page="citas">
            <header><h2>Agenda de Citas</h2></header>
            <section class="card no-print">
              <div class="row" style="margin-bottom:16px">
                <div class="col"><label>Fecha</label><input id="agendaMedicaFecha" type="date" /></div>
                <div class="col"><label>Doctor</label><div id="agendaMedicaDoctorDisplay" style="padding:10px;background:#f3f4f6;border-radius:4px;display:flex;align-items:center;font-weight:500;color:#374151">-</div></div>
                <div class="col" style="display:flex;align-items:flex-end"><button id="cargarTurnosMedica" style="width:100%">Cargar Citas</button></div>
              </div>
              <div style="text-align:center;margin-top:8px">
                <div id="agendaMedicaFechaDisplay" style="font-size:18px;font-weight:700;color:#111;text-transform:uppercase"></div>
              </div>
            </section>
            <!-- Botones para Doctor: Llamar siguiente / Marcar atendido -->
            <section class="card no-print" id="agendaDoctorAcciones" style="display:none;background:#f0f9ff;border-left:4px solid #0369a1">
              <h3>Acciones R√°pidas</h3>
              <div style="display:flex;gap:16px;flex-wrap:wrap">
                <button id="btnLlamarSiguiente" class="btn-llamar">üì¢ Llamar siguiente paciente</button>
                <button id="btnMarcarAtendido" class="btn-marcar">‚úì Marcar como atendido</button>
              </div>
            </section>
            <section class="card no-print" id="agendaNuevoTurnoSection">
              <h3>Nueva Cita</h3>
              <div class="row" id="agendaNuevoTurnoRow">
                <div class="col"><label>Documento</label><input id="nuevoPacienteDocMedica" type="text" placeholder="Documento" /></div>
                <div class="col"><label>Paciente</label><input id="nuevoPacienteNombreMedica" type="text" placeholder="Buscar o crear paciente..." list="pacientesListMedica" /><datalist id="pacientesListMedica"></datalist></div>
                <div class="col">
                  <label>Entidad</label>
                  <select id="nuevoTurnoEntidadMedica">
                    <option value="">Seleccionar</option>
                    <option value="Protegemos">Protegemos</option>
                    <option value="Global Salud">Global Salud</option>
                    <option value="Particular">Particular</option>
                    <option value="Medica Preferencial">Medica Preferencial</option>
                    <option value="Multiservicios">Multiservicios</option>
                    <option value="Medica Estar Bien">Medica Estar Bien</option>
                    <option value="Previred">Previred</option>
                    <option value="Prevenir Descuentos">Prevenir Descuentos</option>
                    <option value="Clical Medic">Clical Medic</option>
                    <option value="Medicina Para Todos">Medicina Para Todos</option>
                  </select>
                </div>
                <div class="col"><label>Prioridad</label><select id="nuevoTurnoPrioridadMedica"><option value="2">Normal</option><option value="1">Prioritario</option></select></div>
              </div>
              <div class="row" style="margin-top:12px">
                <div class="col"><label>Hora</label><select id="nuevoTurnoHoraMedica"></select></div>
                <div class="col"><label>Tel√©fono</label><input id="nuevoPacienteTelefonoMedica" type="tel" placeholder="Tel√©fono" /></div>
                <div class="col"><label>Tipo de consulta</label><select id="nuevoTurnoTipoMedica"><option value="">Seleccionar</option><option>Consulta General</option><option>Control</option><option>Urgencia</option><option>Electrodiagn√≥stico</option><option>Otro</option></select></div>
                <div class="col"><label>Oportunidad (n¬∞)</label><input id="nuevoTurnoOportunidadMedica" type="number" min="0" step="1" /></div>
              </div>
              <div class="row" style="margin-top:8px">
                <div class="col" style="width:100%"><label>Notas</label><textarea id="nuevoTurnoNotasMedica" rows="2" placeholder="Observaciones, preparaci√≥n, info relevante..."></textarea></div>
              </div>
              <div style="margin-top:8px;text-align:right;font-size:0.95rem;color:#444">Programado por: <span id="nuevoTurnoProgramadoPor">-</span></div>
              <div style="margin-top:12px;text-align:right"><button id="crearTurnoMedica" style="width:220px">Crear Cita</button></div>
            </section>
            <section class="card">
              <h3>Citas del D√≠a</h3>
              <div id="turnosListMedica" style="overflow-x:auto">
                <table id="turnosTableMedica" style="width:100%;border-collapse:collapse">
                  <thead>
                    <tr style="background:#f0f0f0">
                      <th style="padding:8px;border:1px solid #ddd">Turno</th>
                      <th style="padding:8px;border:1px solid #ddd" class="col-hora">Hora</th>
                      <th style="padding:8px;border:1px solid #ddd">Paciente</th>
                      <th style="padding:8px;border:1px solid #ddd">Tipo consulta</th>
                      <th style="padding:8px;border:1px solid #ddd">Documento</th>
                      <th style="padding:8px;border:1px solid #ddd">Entidad</th>
                      <th style="padding:8px;border:1px solid #ddd">Estado</th>
                      <th style="padding:8px;border:1px solid #ddd">Notas</th>
                      <th style="padding:8px;border:1px solid #ddd">Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="turnosTableBodyMedica">
                    <tr><td colspan="9" style="padding:20px;text-align:center;color:#999">Selecciona fecha y consultorio para ver las citas</td></tr>
                  </tbody>
                </table>
              </div>
            </section>
          </div>
          
          <!-- P√ÅGINA: PROGRAMAR AGENDA -->
          <div class="agenda-page" data-agenda-page="programar">
            <header><h2 id="agendaTitleHeader">Programar Agenda</h2></header>
            <!-- Subir agenda (solo doctores) -->
            <section class="card" id="agendaProgramarSection" style="display:none">
              <h3>Subir Archivo de Agenda</h3>
              <p>Sube cualquier archivo con tu disponibilidad de horarios (Excel, CSV, PDF, etc.)</p>
              <input id="agendaProgramarFile" type="file" />
              <div style="margin-top:8px"><button id="agendaProgramarUpload" disabled>Subir archivo</button></div>
              <div id="agendaProgramarPreview" style="margin-top:12px;overflow:auto"></div>
            </section>
            <!-- Ver agenda de m√©dicos (recepci√≥n) -->
            <section class="card" id="agendaVerMedicosSection" style="display:none">
              <h3>Agenda Programada de M√©dicos</h3>
              <div style="margin-bottom:16px">
                <label>Seleccionar m√©dico:</label>
                <select id="agendaDoctorSelect" style="width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:.95rem;margin-top:4px"></select>
              </div>
              <div id="agendaDoctorSchedule" style="overflow:auto"></div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para seleccionar doctor (Agenda M√©dica) -->
  <div id="modalSelectDoctor" class="modal-overlay hidden">
    <div class="modal-box" style="max-width:400px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <h3 style="margin:0;font-size:1.1rem">Selecciona un m√©dico</h3>
        <button id="btnCerrarSelectDoctor" class="btn-estado-small" style="background:#6b7280;color:white">‚úï</button>
      </div>
      <div id="medicosListContainer" style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px">
        <!-- Se llena din√°micamente -->
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button id="btnCancelarSelectDoctor" class="btn-estado-small" style="background:#6b7280;color:white">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal edici√≥n de paciente/turno (Agenda M√©dica) -->
    <div id="agendaEditPacienteSection" class="modal-overlay hidden">
    <div class="modal-box">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 style="margin:0;font-size:1rem">Editar paciente / cita</h3>
        <button id="btnCerrarEditPaciente" class="btn-estado-small" style="background:#6b7280;color:white">‚úï</button>
      </div>
      <div id="agendaEditInfo" style="font-size:0.9rem;color:#4b5563;margin-bottom:8px">
        Ning√∫n paciente seleccionado.
      </div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div>
          <label>Nombre del paciente</label>
          <input id="editPacienteNombreMedica" type="text" placeholder="Nombre para llamar al paciente" />
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button id="btnGuardarNombreMedica">Guardar nombre</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== M√ìDULO USUARIOS (solo admin) ========== -->
  <div id="view-usuarios" class="view-module hidden">
    <div class="main-layout">
      <div class="sidebar">
        <button class="btn-volver" id="btnVolverUsuarios">‚Üê Volver</button>
        <div style="margin-bottom:24px;text-align:center">
          <img src="logo.png" alt="Logo" style="height:70px;width:auto;object-fit:contain" />
        </div>
        <h2 style="color:white;margin-bottom:16px">Usuarios</h2>
      </div>
      <div class="main-content">
        <div class="container">
          <header><h2>Gesti√≥n de Usuarios</h2></header>
          <section class="card no-print" id="usuariosNuevoSection">
            <h3>Nuevo Usuario</h3>
            <div class="row">
              <div class="col"><label>Usuario</label><input id="newUserUsuario" type="text" placeholder="Usuario" /></div>
              <div class="col"><label>Contrase√±a</label><input id="newUserPassword" type="password" placeholder="Contrase√±a" /></div>
              <div class="col"><label>Nombre</label><input id="newUserName" type="text" placeholder="Nombre completo" /></div>
              <div class="col"><label>Rol</label><select id="newUserRol"><option value="recepcion">Recepci√≥n</option><option value="electro">Electrodiagn√≥stico</option><option value="doctor">Doctor</option><option value="admin">Administrador</option></select></div>
              <div class="col" id="consultorioCol" style="display:none"><label>Consultorio #</label><input id="newUserConsultorio" type="number" placeholder="N√∫mero de consultorio" min="1" /></div>
              <div class="col" style="display:flex;align-items:flex-end"><button id="crearUsuario" style="width:100%">Crear Usuario</button></div>
            </div>
          </section>
          <section class="card">
            <h3>Usuarios Existentes</h3>
            <div id="usuariosList" style="overflow-x:auto">
              <table id="usuariosTable" style="width:100%;border-collapse:collapse">
                <thead><tr style="background:#f0f0f0"><th style="padding:8px;border:1px solid #ddd">Usuario</th><th style="padding:8px;border:1px solid #ddd">Nombre</th><th style="padding:8px;border:1px solid #ddd">Rol</th><th style="padding:8px;border:1px solid #ddd">Consultorio</th><th style="padding:8px;border:1px solid #ddd">Estado</th><th style="padding:8px;border:1px solid #ddd">Acciones</th></tr></thead>
                <tbody id="usuariosTableBody"></tbody>
              </table>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== M√ìDULO AGENDA ELECTRODIAGN√ìSTICO ========== -->
  <div id="view-electro" class="view-module hidden">
    <div class="main-layout">
      <div class="sidebar">
        <button class="btn-volver" id="btnVolverElectro">‚Üê Volver</button>
        <div style="margin-bottom:24px;text-align:center">
          <img src="logo.png" alt="Logo" style="height:70px;width:auto;object-fit:contain" />
        </div>
        <h2 style="color:white;margin-bottom:16px">Agenda Electrodiagn√≥stico</h2>
        <p style="color:rgba(255,255,255,0.9);font-size:0.9rem">4 equipos disponibles</p>
      </div>
      <div class="main-content">
        <div class="container">
          <header><h2>Agenda de Equipos de Electrodiagn√≥stico</h2></header>
          <section class="card no-print">
            <div class="row" style="margin-bottom:16px">
              <div class="col"><label>Fecha</label><input id="electroFecha" type="date" /></div>
              <div class="col"><label>Equipo</label><select id="electroEquipo"><option value="">Seleccionar equipo</option></select></div>
              <div class="col" style="display:flex;align-items:flex-end"><button id="cargarCitasElectro" style="width:100%">Cargar Agenda</button></div>
            </div>
          </section>
          <section class="card no-print" id="electroNuevaCitaSection">
            <h3>Nueva Cita</h3>
            <div class="row" id="electroNuevaCitaRow">
              <div class="col"><label>Paciente</label><input id="nuevoPacienteElectro" type="text" placeholder="Buscar o crear paciente..." list="pacientesListElectro" /><datalist id="pacientesListElectro"></datalist></div>
              <div class="col"><label>Documento</label><input id="nuevoPacienteDocElectro" type="text" placeholder="Documento" /></div>
              <div class="col"><label>Hora inicio</label><input id="electroHoraInicio" type="time" /></div>
              <div class="col"><label>Hora fin</label><input id="electroHoraFin" type="time" /></div>
              <div class="col"><label>Estudio</label><input id="electroEstudio" type="text" placeholder="Ej: EEG, Polisomnograf√≠a" /></div>
              <div class="col" style="display:flex;align-items:flex-end"><button id="crearCitaElectro" style="width:100%">Crear Cita</button></div>
            </div>
          </section>
          <section class="card">
            <h3>Citas del D√≠a</h3>
            <div id="citasElectroList" style="overflow-x:auto">
              <table id="citasElectroTable" style="width:100%;border-collapse:collapse">
                <thead>
                  <tr style="background:#f0f0f0">
                    <th style="padding:8px;border:1px solid #ddd">Hora</th>
                    <th style="padding:8px;border:1px solid #ddd">Paciente</th>
                    <th style="padding:8px;border:1px solid #ddd">Documento</th>
                    <th style="padding:8px;border:1px solid #ddd">Estudio</th>
                    <th style="padding:8px;border:1px solid #ddd">Estado</th>
                    <th style="padding:8px;border:1px solid #ddd" id="electroEditadoTh">Editado por</th>
                    <th style="padding:8px;border:1px solid #ddd">Acciones</th>
                  </tr>
                </thead>
                <tbody id="citasElectroBody">
                  <tr><td colspan="7" style="padding:20px;text-align:center;color:#999">Selecciona fecha y equipo para ver las citas</td></tr>
                </tbody>
              </table>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Cambiar Contrase√±a -->
  <!-- MODAL: GESTIONAR CUENTA -->
  <div id="modalCambiarContrasena" class="modal-overlay hidden">
    <div class="modal-box" style="max-width:500px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid #e5e7eb">
        <h3 style="margin:0;color:#627371;font-size:20px;font-weight:600">Gestionar Cuenta</h3>
        <button class="btn-close-modal" onclick="closeCambiarContrasenaModal()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#627371;transition:color 0.2s" onmouseover="this.style.color='#3f4a48'" onmouseout="this.style.color='#627371'">‚úï</button>
      </div>
      <form id="formCambiarContrasena" style="display:flex;flex-direction:column;gap:16px">
        <div>
          <label for="cuentaNombreActual" style="display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px">Nombre Completo</label>
          <input id="cuentaNombreActual" type="text" placeholder="Tu nombre completo" style="width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;font-size:14px;transition:all 0.2s" onfocus="this.style.borderColor='#627371';this.style.boxShadow='0 0 0 3px rgba(98,115,113,0.1)'" onblur="this.style.borderColor='#d1d5db';this.style.boxShadow='none'" />
        </div>
        
        <div style="padding-top:12px;border-top:1px solid #e5e7eb;">
          <h4 style="color:#627371;font-size:15px;font-weight:600;margin:0 0 16px 0">Cambiar Contrase√±a</h4>
          
          <div>
            <label for="contrasenaActual" style="display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px">Contrase√±a Actual</label>
            <input id="contrasenaActual" type="password" placeholder="Ingresa tu contrase√±a actual" style="width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;font-size:14px;transition:all 0.2s" onfocus="this.style.borderColor='#627371';this.style.boxShadow='0 0 0 3px rgba(98,115,113,0.1)'" onblur="this.style.borderColor='#d1d5db';this.style.boxShadow='none'" />
          </div>
          <div>
            <label for="nuevaContrasena" style="display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px">Nueva Contrase√±a</label>
            <input id="nuevaContrasena" type="password" placeholder="Ingresa tu nueva contrase√±a" style="width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;font-size:14px;transition:all 0.2s" onfocus="this.style.borderColor='#627371';this.style.boxShadow='0 0 0 3px rgba(98,115,113,0.1)'" onblur="this.style.borderColor='#d1d5db';this.style.boxShadow='none'" />
          </div>
          <div>
            <label for="confirmarContrasena" style="display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px">Confirmar Nueva Contrase√±a</label>
            <input id="confirmarContrasena" type="password" placeholder="Confirma tu nueva contrase√±a" style="width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;font-size:14px;transition:all 0.2s" onfocus="this.style.borderColor='#627371';this.style.boxShadow='0 0 0 3px rgba(98,115,113,0.1)'" onblur="this.style.borderColor='#d1d5db';this.style.boxShadow='none'" />
          </div>
        </div>
        
        <div id="cambiarContrasenaError" class="login-error hidden" style="padding:12px;background:#fee;border:1px solid #fcc;border-radius:6px;color:#c00;font-size:14px"></div>
        <div style="display:flex;gap:12px;margin-top:20px;padding-top:20px;border-top:1px solid #e5e7eb">
          <button type="submit" style="flex:1;padding:11px 16px;background:#627371;color:white;border:none;border-radius:6px;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#4f5f5c'" onmouseout="this.style.background='#627371'">Guardar Cambios</button>
          <button type="button" style="flex:1;padding:11px 16px;background:#e5e7eb;color:#374151;border:none;border-radius:6px;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s" onclick="closeCambiarContrasenaModal()" onmouseover="this.style.background='#d1d5db'" onmouseout="this.style.background='#e5e7eb'">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL: EDITAR USUARIO (ADMIN) -->
  <div id="modalEditarUsuario" class="modal-overlay hidden">
    <div class="modal-box" style="max-width:500px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid #e5e7eb">
        <h3 style="margin:0;color:#627371;font-size:20px;font-weight:600">Editar Usuario</h3>
        <button class="btn-close-modal" onclick="closeEditarUsuarioModal()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#627371;transition:color 0.2s" onmouseover="this.style.color='#3f4a48'" onmouseout="this.style.color='#627371'">‚úï</button>
      </div>
      <form id="formEditarUsuario" style="display:flex;flex-direction:column;gap:16px">
        <div>
          <label for="editUsu" style="display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px">Usuario</label>
          <input id="editUsu" type="text" placeholder="Usuario (no editable)" readonly style="width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;background:#f9fafb;color:#666;font-size:14px" />
        </div>
        <div>
          <label for="editNombre" style="display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px">Nombre Completo</label>
          <input id="editNombre" type="text" placeholder="Nombre del usuario" required style="width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;font-size:14px;transition:all 0.2s" onfocus="this.style.borderColor='#627371';this.style.boxShadow='0 0 0 3px rgba(98,115,113,0.1)'" onblur="this.style.borderColor='#d1d5db';this.style.boxShadow='none'" />
        </div>
        <div>
          <label for="editRol" style="display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px">Rol</label>
          <select id="editRol" required style="width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;font-size:14px;background-color:white;cursor:pointer;transition:all 0.2s" onfocus="this.style.borderColor='#627371';this.style.boxShadow='0 0 0 3px rgba(98,115,113,0.1)'" onblur="this.style.borderColor='#d1d5db';this.style.boxShadow='none'">
            <option value="recepcion">Recepci√≥n</option>
            <option value="electro">Electrodiagn√≥stico</option>
            <option value="doctor">Doctor</option>
            <option value="admin">Administrador</option>
          </select>
        </div>
        <div id="editConsultorioCol" style="display:none">
          <label for="editConsultorio" style="display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px">N√∫mero de Consultorio</label>
          <input id="editConsultorio" type="number" placeholder="N√∫mero de consultorio" min="1" style="width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;font-size:14px;transition:all 0.2s" onfocus="this.style.borderColor='#627371';this.style.boxShadow='0 0 0 3px rgba(98,115,113,0.1)'" onblur="this.style.borderColor='#d1d5db';this.style.boxShadow='none'" />
        </div>
        <div>
          <label for="editPassword" style="display:block;margin-bottom:8px;font-weight:500;color:#333;font-size:14px">Nueva Contrase√±a</label>
          <input id="editPassword" type="password" placeholder="Dejar vac√≠o para no cambiar" style="width:100%;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;font-size:14px;transition:all 0.2s" onfocus="this.style.borderColor='#627371';this.style.boxShadow='0 0 0 3px rgba(98,115,113,0.1)'" onblur="this.style.borderColor='#d1d5db';this.style.boxShadow='none'" />
        </div>
        <div id="editarUsuarioError" class="login-error hidden" style="padding:12px;background:#fee;border:1px solid #fcc;border-radius:6px;color:#c00;font-size:14px;display:none"></div>
        <div style="display:flex;gap:12px;margin-top:20px;padding-top:20px;border-top:1px solid #e5e7eb">
          <button type="submit" style="flex:1;padding:11px 16px;background:#627371;color:white;border:none;border-radius:6px;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s" onmouseover="this.style.background='#4f5f5c'" onmouseout="this.style.background='#627371'">Guardar Cambios</button>
          <button type="button" style="flex:1;padding:11px 16px;background:#e5e7eb;color:#374151;border:none;border-radius:6px;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.2s" onclick="closeEditarUsuarioModal()" onmouseover="this.style.background='#d1d5db'" onmouseout="this.style.background='#e5e7eb'">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- ========== FOOTER ========== -->
  <footer class="app-footer">
    <div class="footer-content">
      <p>&copy; <span id="currentYear"></span> ¬ÆInstituto Neurociencias de Nari√±o S.A.S. Todos los derechos reservados.</p>
      <p>Desarrollado por: <span style="font-weight:600">Coordinaci√≥n √Årea de Sistemas</span></p>
    </div>
  </footer>

  <script src="app.js"></script>
  <script src="socket-client.js"></script>
  <script>
    // Establecer a√±o actual en footer
    document.getElementById('currentYear').textContent = new Date().getFullYear();
  </script>
</body>
</html>
